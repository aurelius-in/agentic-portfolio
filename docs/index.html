<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agentic AI Systems Showcase</title>
  <style>
    html, body { margin:0; padding:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:#0b0f13; color:#e7edf3; }
    a { color:#8ecaff; text-decoration:none; }
    a:hover { text-decoration:underline; }
    .wrap { max-width:1100px; margin:0 auto; padding:28px 20px 80px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px; }
    .title { font-size:1.6rem; font-weight:700; letter-spacing:0.2px; }
    .meta { font-size:0.95rem; opacity:0.85; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap:16px; }
    .card { background:#121820; border:1px solid #1e2732; border-radius:14px; overflow:hidden; display:flex; flex-direction:column; }
    .thumb { aspect-ratio: 16/10; background:#0b0f13; display:flex; align-items:center; justify-content:center; position:relative; }
    .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
    .thumb .fallback { font-size:0.9rem; color:#9bb3c7; padding:6px; text-align:center; }
    .badge { position:absolute; bottom:8px; right:8px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.18); padding:2px 6px; border-radius:8px; font-size:.7rem; color:#cfe6ff; }
    .inner { padding:14px 14px 16px; display:flex; gap:12px; flex-direction:column; }
    .name { font-weight:700; font-size:1.05rem; line-height:1.3; }
    .summary { color:#b5c6d6; font-size:0.95rem; line-height:1.35; }
    .tags { display:flex; flex-wrap:wrap; gap:6px; }
    .tag { font-size:0.75rem; background:#0c2436; color:#9fd0ff; border:1px solid #15354b; padding:4px 8px; border-radius:999px; }
    .repo { margin-top:auto; font-size:0.9rem; }
    .footer { margin-top:26px; opacity:0.75; font-size:0.9rem; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Agentic AI Systems Showcase</div>
      <div class="meta" id="contact"></div>
    </header>

    <section class="grid" id="grid" aria-live="polite"></section>

    <div class="footer">
  
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const ROTATE_MS = Math.max(1000, parseInt(params.get('interval') || '6000', 10) || 6000);

    function normalizeGithubImage(url) {
      if (!url || typeof url !== 'string') return url;
      const m = url.match(/^https?:\/\/github\.com\/([^\/]+)\/([^\/]+)\/blob\/([^\/]+)\/(.+)$/);
      if (m) {
        const [, user, repo, branch, path] = m;
        return `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${path}`;
      }
      return url;
    }

    function createRotatingImage(urls, altText, rotateMs) {
      const container = document.createElement('div');
      container.className = 'thumb';

      const list = (urls || []).map(normalizeGithubImage).filter(Boolean);
      if (list.length === 0) {
        const fb = document.createElement('div');
        fb.className = 'fallback';
        fb.innerText = '(no image)';
        container.appendChild(fb);
        return container;
      }

      const badge = document.createElement('div');
      badge.className = 'badge';
      badge.textContent = list.length > 1 ? 'rotating' : 'preview';
      container.appendChild(badge);

      const failed = new Set();
      let i = 0;
      let timer = null;

      const img = document.createElement('img');
      img.alt = altText || 'preview';

      function pickNextIndex(startFrom) {
        let attempts = 0;
        let idx = startFrom % list.length;
        while (attempts < list.length && failed.has(idx)) {
          idx = (idx + 1) % list.length;
          attempts++;
        }
        return attempts >= list.length ? -1 : idx;
      }

      function show(index) {
        if (index === -1) {
          img.replaceWith(Object.assign(document.createElement('div'),{
            className:'fallback',
            innerText:'(no image)'
          }));
          if (timer) clearInterval(timer);
          badge.textContent = 'unavailable';
          return;
        }
        i = index;
        img.src = list[i];
      }

      img.onerror = () => {
        failed.add(i);
        const next = pickNextIndex(i + 1);
        show(next);
      };

      img.onload = () => {
        if (!timer && list.length > 1) {
          timer = setInterval(() => {
            const next = pickNextIndex(i + 1);
            if (next === -1) {
              clearInterval(timer);
              timer = null;
              badge.textContent = 'preview';
              return;
            }
            show(next);
          }, rotateMs);
        }
      };

      container.addEventListener('mouseenter', () => {
        if (timer) { clearInterval(timer); timer = null; badge.textContent = 'paused'; }
      });
      container.addEventListener('mouseleave', () => {
        if (!timer && list.length > 1) {
          badge.textContent = 'rotating';
          timer = setInterval(() => {
            const next = pickNextIndex(i + 1);
            if (next === -1) {
              clearInterval(timer);
              timer = null;
              badge.textContent = 'preview';
              return;
            }
            show(next);
          }, rotateMs);
        }
      });

      container.appendChild(img);
      show(pickNextIndex(0));
      return container;
    }

    async function load() {
      const grid = document.getElementById('grid');
      const contact = document.getElementById('contact');
      try {
        const res = await fetch('./portfolio.json', {cache:'no-store'});
        if (!res.ok) throw new Error('Missing docs/portfolio.json');
        const data = await res.json();

        if (data?.contact) {
          const parts = [];
          if (data.contact.email) parts.push(`<a href="mailto:${data.contact.email}">${data.contact.email}</a>`);
          if (data.contact.linkedin) parts.push(`<a href="${data.contact.linkedin}" target="_blank" rel="noopener">LinkedIn</a>`);
          contact.innerHTML = parts.join(" • ");
        }

        const projects = (data.projects || []).slice().sort((a,b)=>a.name.localeCompare(b.name));
        grid.innerHTML = '';
        projects.forEach(p => {
          const card = document.createElement('article');
          card.className = 'card';
          const thumb = createRotatingImage(p.images, p.name, ROTATE_MS);
          const inner = document.createElement('div');
          inner.className = 'inner';
          inner.innerHTML = `
            <div class="name">${p.name}</div>
            <div class="summary">${p.summary || ''}</div>
            <div class="tags">${(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
            <div class="repo"><a href="${p.repo}" target="_blank" rel="noopener">View Repository</a>${(p.stack||[]).length ? ` · <span title="Stack">${(p.stack||[]).slice(0,6).join(' • ')}</span>` : ''}</div>
          `;
          card.appendChild(thumb);
          card.appendChild(inner);
          grid.appendChild(card);
        });
      } catch (e) {
        grid.innerHTML = `<div class="note">Error: ${e.message}. Make sure <code>docs/portfolio.json</code> exists.</div>`;
      }
    }
    load();
  </script>
</body>
</html>
